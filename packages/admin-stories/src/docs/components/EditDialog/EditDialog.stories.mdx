import { Meta, Story, Canvas, Source } from "@storybook/addon-docs";

import dedent from "ts-dedent";

<Meta title="Docs/Components/Edit Dialog" />

# Edit Dialog

An EditDialog typically includes a form that allows users to edit a resource.
It's often used to edit a single row of a table.

## EditDialog

There are two ways to integrate an EditDialog.

### 1) useEditDialog Hook (Recommended)

The recommended way is to use the `useEditDialog` hook.
It returns an instance of `EditDialog` and the corresponding `editDialogApi`.

<Canvas>
    <Story id="stories-components-editdialog-useeditdialog--useeditdialog" />
</Canvas>

### 2) EditDialog Component

Alternatively, you can import the `EditDialog` component from `@comet/admin` and use it directly.
To gain access to the `editDialogApi`, you need to attach a ref to the component.

<Canvas>
    <Story id="stories-components-editdialog-edit-dialog--edit-dialog" />
</Canvas>

## useEditDialogApi and EditDialogApiContext

You can access the `editDialogApi` using the `useEditDialogApi` hook.
As a prerequisite you need to pass the `editDialogApi` to the `EditDialogApiContext.Provider` somewhere higher up
in the component tree.

<Canvas>
    <Story id="stories-components-editdialog-useeditdialogapi--useeditdialogapi" />
</Canvas>

## EditDialog in a Table

The most common use case for an EditDialog is for editing single rows in a table.

<Canvas>
    <Story id="stories-components-editdialog-editdialogusertable--edit-dialog-user-table" />
</Canvas>

## Caveats

### EditDialog and Enter

If the user uses the enter key (instead of the Save button) to submit the form inside `EditDialog`,
the `handleSaveClick` method is not called.
This may lead to the unwanted behavior that the `EditDialog` doesn't close after a successful submit.

To avoid this behavior, `selectionApi.handleDeselect()` must be called in the form's `onAfterSubmit` method.
The selectionApi is among the return values of `useEditDialog()`.
You can find a working example [here](#editdialog-in-a-table).

<Source
    language="tsx"
    code={dedent`
    <FinalForm
        // ...
        onAfterSubmit={() => {
            selectionApi.handleDeselect();
        }}
    >
        {/* ... */}
    </FinalForm>
`}
/>
