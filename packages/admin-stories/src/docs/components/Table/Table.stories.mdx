import { Meta, Canvas, Story, Source } from "@storybook/addon-docs";

import dedent from "ts-dedent";

<Meta title="Docs/Components/Table" />

# Table

> Tables display information in a way that's easy to scan, so that users can look for patterns and insights.
>
> \- [MUI Docs](https://mui.com/components/tables/)

## Table

<Canvas>
    <Story id="stories-components-table-basic-table--basic-table" />
</Canvas>

Table has three required parameters: `data`, `totalCount` and `columns`.

`data` contains the data that should be displayed in the table. It must be an array of objects and each object must have a unique `id`.

`totalCount` specifies the total number of items.
It's only relevant if pagination is used. Then, the totalCount should be provided by the API.
If **no pagination** is used, `totalCount` can simply be set to `data.length`.

`columns` is an array that defines the structure of the table.
It specifies which columns exist and how to render them.
More information can be found in the [column section](#table-column).

## Table Column

### name

The only required property of a column is its `name`.
Per default, the `name` is matched to a property of `data` which is then rendered:

<Canvas>
    <Story id="stories-components-table-table-column-props--table-column-name-prop" />
</Canvas>

This also works for nested properties if the `name` is separated by dots:

<Canvas>
    <Story id="stories-components-table-table-column-props--table-column-nested-name-prop" />
</Canvas>

### render

The default rendering behavior can be overwritten by passing a function to the `render` prop.
The render function can be used for altering the styling of a column or for rendering columns that don't have a corresponding prop in `data`:

<Canvas>
    <Story id="stories-components-table-table-column-props--table-column-render-prop" />
</Canvas>

### header

The `header` property defines the heading of a column.
It can be a string or a JSX element.

If no header is set, the heading of a column is empty.

<Canvas>
    <Story id="stories-components-table-table-column-props--table-column-header-prop" />
</Canvas>

### visible

`visible` can be used to hide a column.

<Canvas>
    <Story id="stories-components-table-table-column-props--table-column-visible-prop" />
</Canvas>

### cellProps & headerProps

Internally, the `Table` uses Material UI's `TableCell` for rendering table headers and table cells.
`cellProps` and `headerProps` can be used to pass props to these internal elements.
More information can be found in the [Material UI Docs](https://v4.mui.com/api/table-cell/).

### sortable

See [Sorting section](#sorting)

### headerExcel & renderExcel & formatForExcel

See [Excel Export section](#excel-export)

## TableQuery

To fill a `Table` with API data, you can use the `useTableQuery()` hook in combination with the
`TableQuery` component.

The `useTableQuery()` hook is a wrapper of Apollo Client's [useQuery()](https://www.apollographql.com/docs/react/data/queries/#usequery-api).
To use this hook, you have to pass a GraphQL query and a `resolveTableData()` function.
`resolveTableData()` converts the GraphQL response to an object the `Table` can work with.
The `useTableQuery()` hook returns the converted response (`tableData`), an `api` object and the [Apollo query result](https://www.apollographql.com/docs/react/data/queries/#result).

`TableQuery` can be used to wrap a `Table`.
It has a built-in loading state and error handling.
All you have to do is pass the `api`, `error` and `loading` props returned by `useTableQuery()` to `TableQuery`.

<Canvas>
    <Story id="stories-components-table-tablequery--tablequery" />
</Canvas>

## Pagination

TODO after https://github.com/vivid-planet/comet-admin/pull/579 is merged

## Sorting

The `Table` component has built-in support for sorting by column.
To use this functionality, you have to follow the following steps:

1.  get an instance of `sortApi` from the `useTableQuerySort()` hook
2.  pass the `sortApi` to the `Table` component
3.  set the property `sortable` to `true` for all columns that you want to sort by
4.  use the values of `sortApi` in your API call

You can then sort the table ascending or descending by column by clicking on the column header.

<Canvas>
    <Story id="stories-components-table-sortable-table--sortable-table" />
</Canvas>

## Filterbar

## Excel Export

## TableDndOrder

## usePersistedState

tba.

-   paging
-   sorting
-   filterbar
-   excel export
-   DnD Order
-   usePersistedState
