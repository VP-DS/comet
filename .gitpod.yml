# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - before: |
      echo "IMGPROXY_URL=$(gp url 6080)" > .env.local
      echo "API_URL=$(gp url 4000)" >> .env.local
      echo "CORS_ALLOWED_ORIGINS=\"^$(gp url 8001),^$(gp url 3000),^http:\/\/localhost:\d+\"" >> .env.local
      echo "ADMIN_URL=$(gp url 8001)" >> .env.local
      echo "SITE_URL=$(gp url 3000)" >> .env.local
      echo "NEXTAUTH_URL=$(gp url 3000)/api/auth" >> .env.local
      echo "IDP_URL=$(gp url 3011)" >> .env.local
    init: |
      ./install.sh
      yarn build:lib
    command: yarn run dev:demo
ports:
  - name: Demo API
    port: 4000
    onOpen: notify
    visibility: public
  - name: Demo Admin
    port: 8001
    onOpen: notify
    visibility: private
  - name: Demo Site
    port: 3000
    onOpen: notify
    visibility: private
  - name: IDP
    port: 3011
    onOpen: ignore
    visibility: public
  - name: imgproxy
    port: 6080
    onOpen: ignore
    visibility: private
  - name: postgresql
    port: 5432
    onOpen: ignore
    visibility: private
